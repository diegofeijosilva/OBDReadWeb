<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="#{userSettingsMB.layout}">

	<ui:define name="body">

		<f:metadata>
			<f:viewParam name="id" value="#{cronogramaFormMB.id}"
				converter="javax.faces.Long" />
		</f:metadata>
		<f:event type="preRenderView" listener="#{cronogramaFormMB.init}" />
		<p:focus />


		<h:form id="form">
			<p:panel header="Cadastro Cronograma">

				<p:messages id="messages" showDetail="true" autoUpdate="true" closable="true" globalOnly="true"/>

				<p:commandButton value="#{msg['label.save']}" action="#{cronogramaFormMB.salva}" update="@form" icon="ui-icon-check" rendered="true" 
									oncomplete="setTimeout(function() { $('[id$=messages]').hide(2000); }, 3000);"/>
				
				<p:commandButton value="#{msg['label.cancelar']}" icon="ui-icon-circle-close" process="@this" oncomplete="PF('confirmaCancelarDialog').show();" 
								 rendered="#{!cronogramaFormMB.inclusao}" disabled="#{cronogramaFormMB.ed.situacao == 9 }"/>
								 
				<p:commandButton value="#{msg['label.publicar']}" icon="ui-icon-circle-check" process="@this" oncomplete="PF('publicarDialog').show();" 
								 disabled="#{cronogramaFormMB.ed.situacao != 7}"  rendered="#{!cronogramaFormMB.inclusao and sessionMB.hasPermission('GID','CRONOGRAMA-JUN','PUB')}"/>
				
				<p:commandButton value="#{msg['label.agendamentos']}" icon="ui-icon-contact" process="@this" oncomplete="PF('agendamentosCronograma').show();" 
								 rendered="#{!cronogramaFormMB.inclusao and sessionMB.hasPermission('GID','H119','L')}" action="#{cronogramaFormMB.carregaAgendamentos}" update="@form"/>
				
				<p:commandButton value="#{msg['label.historico']}" icon="ui-icon-document" process="@this" oncomplete="PF('exibeHistorico').show();" 
								 rendered="#{!cronogramaFormMB.inclusao and sessionMB.hasPermission('GID','JUN-CRO-HIS','')}"/>
								 
				<p:commandButton value="Transferir Cronograma" icon="ui-icon-document" process="@this" oncomplete="PF('transfereCronograma').show();" 
								 rendered="#{sessionMB.hasPermission('GID','CRONOGRAMA-JUN','CFG') and !cronogramaFormMB.inclusao}"/>
									
				<p:commandButton value="#{msg['label.back']}" action="junta-cronograma-list?faces-redirect=trueflagPesquisa=1" 
								 process="@this" icon="ui-icon-close" />

				<p:separator />
				<p:tabView dynamic="true" cache="false">
					<p:tab title="Geral">

						<h:panelGrid columns="6" cellspacing="0">

							<p:outputLabel for="municipio" value="Municipio: " />
							<p:selectOneMenu id="municipio" style="width: 200px" value="#{cronogramaFormMB.ed.municipioED}" disabled="#{not cronogramaFormMB.inclusao}" converter="entityConverter">
								<f:selectItems value="#{cronogramaFormMB.listaMunicipio}"  var="c"   
                                               itemLabel="#{c.nomeMunicipio}" itemValue="#{c}"/>
                                       
                                <p:ajax listener="#{cronogramaFormMB.alteraCredenciado}"  update="painelProfsECredenciado, hrInicio, maxAtendimento"/>     
							</p:selectOneMenu>
							<p:message for="municipio" />

							<p:outputLabel value=" " />
							<p:outputLabel value=" " />
							<p:outputLabel value=" " />

							<p:outputLabel for="dataAgenda" value="Data Agenda: " />
							<p:calendar id="dataAgenda" showOn="button" pattern="dd/MM/yyyy" mask="true" value="#{cronogramaFormMB.ed.dthAgenda}" size="10" required="true"
								onSelectUpdate="dateGroup" disabled="#{not cronogramaFormMB.inclusao}">
								<f:converter converterId="dateCalendarConverter" />
							</p:calendar>
							<p:message for="dataAgenda"/>

							<p:outputLabel for="hrInicio" value="Hora Início: " />
							<p:inputMask id="hrInicio" value="#{cronogramaFormMB.ed.horaInicio}" size="4" mask="99:99" validatorMessage="Hora Inicio inválida" required="true">
								<f:validateRegex pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]" />
 								
							</p:inputMask>
							<p:message for="hrInicio" id="msgHoraInicio"/>

							<p:outputLabel for="turno" value="Turno: " />
							<p:selectOneMenu id="turno" value="#{cronogramaFormMB.ed.turno}">
								<f:selectItems value="#{cronogramaFormMB.listaTurno}" />
								
								<p:ajax listener="#{cronogramaFormMB.alteraCredenciadoTurno}"  update="painelProfsECredenciado, hrInicio, maxAtendimento"/> 
							</p:selectOneMenu>
							<p:message for="turno" />

							<p:outputLabel value=" " />
							<p:outputLabel value=" " />
							<p:outputLabel value=" " />

							<p:outputLabel for="tipoComissao" value="Tipo Comissão: " />
							<p:selectOneMenu id="tipoComissao" value="#{cronogramaFormMB.ed.juntaComissaoED.tpComissao}" disabled="true">
								<f:selectItems value="#{cronogramaFormMB.listaTipoComissao}" />
							</p:selectOneMenu>
							<p:message for="tipoComissao" />

							<p:outputLabel for="comissao" value="Comissão: " />
							<p:inputText id="comissao" value="#{cronogramaFormMB.ed.juntaComissaoED.codComissao}" size="4" required="true" maxlength="4" style="text-transform: uppercase" disabled="true" />
							<p:message for="comissao" />

							<p:outputLabel for="maxAtendimento" value="Max. Atendimento: " />
							<p:inputText id="maxAtendimento" value="#{cronogramaFormMB.ed.atendMax}" size="4" maxlength="2" style="text-transform: uppercase" required="true"/>
							<p:message for="maxAtendimento" />

							<p:outputLabel for="atendimentoExtra" value="Atend. Extra: " />
							<p:inputText id="atendimentoExtra" value="#{cronogramaFormMB.ed.atendExtra}" size="4" maxlength="1" style="text-transform: uppercase"/>
							<p:message for="atendimentoExtra"/>

							<p:outputLabel for="situacao" value="Situação: " />
							<p:selectOneMenu id="situacao"
								value="#{cronogramaFormMB.ed.situacao}" disabled="true">
								<f:selectItems value="#{cronogramaFormMB.listaSituacao}"/>
							</p:selectOneMenu>
							<p:message for="situacao" />

						</h:panelGrid>

						<br />


						<!-- <p:accordionPanel activeIndex="-"> -->
						<p:accordionPanel id="painelProfsECredenciado">
							<p:tab title="Profissionais">

								<h:panelGrid columns="2" cellspacing="0">

									<h:panelGrid columns="3" cellspacing="0">

										<p:outputLabel for="credenciado" value="Credenciado: " />
										<p:inputText id="credenciado" required="true" value="#{cronogramaFormMB.ed.credenciadoED.codCliente}" size="30" 
										maxlength="30" style="text-transform: uppercase">
										</p:inputText>
											
										<p:commandButton value="Substituições"
											process="@this" icon="ui-icon-close"
											disabled="#{!cronogramaFormMB.btnSubstituicoes and sessionMB.hasPermission('GID','H123','L')}" 
											oncomplete="PF('substituicoesDialog').show();"/>

										<p:outputLabel for="profs01" value="Nome: " />
										<p:autoComplete id="profs01" size="50" maxlength="50"
											style="text-transform: uppercase"
											value="#{cronogramaFormMB.profs01}" var="c" itemLabel="#{c.nome}" itemValue="#{c}" 
											completeMethod="#{cronogramaFormMB.completeText}" converter="cronogramaProfissionaisConverter"/>
										<p:outputLabel for="profs01" style="color:red; font-weight:bold;" value="#{cronogramaFormMB.labelProfs01}" />

										<p:outputLabel for="profs02" value="Nome: " />
										<p:autoComplete id="profs02" size="50" maxlength="50"
											style="text-transform: uppercase"
											value="#{cronogramaFormMB.profs02}" var="c" itemLabel="#{c.nome}" itemValue="#{c}" 
											completeMethod="#{cronogramaFormMB.completeText}" converter="cronogramaProfissionaisConverter"/>
										<p:outputLabel for="profs02" style="color:red; font-weight:bold;" value="#{cronogramaFormMB.labelProfs02}" />

										<p:outputLabel for="profs03" value="Nome: " />
										<p:autoComplete id="profs03" size="50" maxlength="50"
											style="text-transform: uppercase"
											value="#{cronogramaFormMB.profs03}" var="c" itemLabel="#{c.nome}" itemValue="#{c}" 
											completeMethod="#{cronogramaFormMB.completeText}" converter="cronogramaProfissionaisConverter"/>
										<p:outputLabel for="profs03" style="color:red; font-weight:bold;" value="#{cronogramaFormMB.labelProfs03}" />

									</h:panelGrid>

									<h:panelGrid columns="1" cellspacing="0">

										


										<br />
										<br />
										<br />
										<br />
										<br />

									</h:panelGrid>

								</h:panelGrid>

							</p:tab>
						</p:accordionPanel>

					</p:tab>
				</p:tabView>
			</p:panel>
		</h:form>
		
		<p:confirmDialog widgetVar="confirmaCancelarDialog" message="#{cronogramaFormMB.exibeMensagemCancelamento()}" header="Confirmação de Cancelamento" 
						severity="alert" appendTo="@(body)" width="300">
			<h:form>  
	     		<p:commandButton value="#{msg['label.yes']}" onclick="confirmaCancelarDialog.hide();" oncomplete="PF('cancelarCronograma').show();" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>  
	     		<p:commandButton value="#{msg['label.no']}" onclick="confirmaCancelarDialog.hide()" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
	     	</h:form>
	  	</p:confirmDialog>
	
	
		<p:confirmDialog widgetVar="confirmaTrocaCredenciadoDialog" message="Atenção! Credenciado não está cadastrado como Local de Atuação da Junta. Confirma continuar?" header="Confirma Substituição de Credenciado" 
						severity="alert" appendTo="@(body)" width="300">
			<h:form>  
	     		<p:commandButton value="#{msg['label.yes']}" onclick="confirmaTrocaCredenciadoDialog.hide();" action="#{cronogramaFormMB.confirmaSalvar}"  styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>  
	     		<p:commandButton value="#{msg['label.no']}" onclick="confirmaTrocaCredenciadoDialog.hide()"  type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
	     	</h:form>
	  	</p:confirmDialog>
	
	  	
	  	<!-- TRANSFERE CRONOGRAMA -->
	  	<p:dialog header="Transferência de Cronograma" dynamic="false" modal="true"
				  appendTo="@(body)" widgetVar="transfereCronograma" resizable="false"
				  width="450">
			<ui:include src="/mod-comissao/junta-cronograma-transferencia.xhtml" />
		</p:dialog>
		
		<p:dialog header="Substituições Cronograma" dynamic="false"
				  modal="true" appendTo="@(body)" widgetVar="substituicoesDialog"
				  height="60%" width="70%" resizable="true">
			<ui:include src="/mod-comissao/junta-cronograma-substituicoes-list.xhtml" />
		</p:dialog>
		
		<p:dialog header="Cancelar Cronograma" dynamic="false" modal="true"
				  appendTo="@(body)" widgetVar="cancelarCronograma" resizable="false"
				  width="550">
			<ui:include src="/mod-comissao/junta-cronograma-cancelar.xhtml" />
		</p:dialog>
		
		<!-- HISTORICO CRONOGRAMA -->
		<p:dialog header="Histórico Cronograma" dynamic="false"
				  modal="true" appendTo="@(body)" widgetVar="exibeHistorico"
				  width="60%" resizable="true">
			<ui:include src="/mod-comissao/junta-cronograma-historico-list.xhtml" />
		</p:dialog>
		
		<!-- AGENDAMENTOS -->
		<p:dialog header="Cronograma Agendamentos" dynamic="false"
				  modal="true" appendTo="@(body)" widgetVar="agendamentosCronograma"
				  height="40%" width="50%" resizable="true">
			<ui:include
				src="/mod-comissao/junta-cronograma-agendamentos-list.xhtml" />
		</p:dialog>
		
		<!-- PUBLICAR CRONOGRAMA -->
		<p:confirmDialog widgetVar="publicarDialog"
			message="#{msg['mensagem.juntaCronograma.publicaTurnosConfirmacao']}"
			header="Confirmação de Publicação" severity="alert"
			appendTo="@(body)" width="350">
			<h:form>
				<p:commandButton value="#{msg['label.yes']}"
					oncomplete="publicarDialog.hide()"
					action="#{cronogramaFormMB.publicarCronograma()}" update="@form"
					styleClass="ui-confirmdialog-yes" icon="ui-icon-check" ajax="false" />
				<p:commandButton value="#{msg['label.no']}"
					onclick="publicarDialog.hide()" type="button"
					styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
			</h:form>
		</p:confirmDialog>
		
		<!-- VALIDAÇÃO PARA DATA EM DIA UTIL E OU FERIADO -->
		<p:confirmDialog widgetVar="diaUtilFeriadoDialog"
			message="Este turno está sendo criado em dia não útil. Confirma?"
			header="Confirmação" severity="alert"
			appendTo="@(body)" width="500">
			<h:form>
				<p:commandButton value="#{msg['label.yes']}"
					oncomplete="diaUtilFeriadoDialog.hide()" 
					action="#{cronogramaFormMB.validaDiaUtileFeriado}" update="@form"
					styleClass="ui-confirmdialog-yes" icon="ui-icon-check" ajax="false" />
				<p:commandButton value="#{msg['label.no']}"
					onclick="diaUtilFeriadoDialog.hide()" type="button"
					styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
			</h:form>
		</p:confirmDialog>
		
		<!-- VALIDAÇÃO PARA ATUAÇÃO EM MENOS DE 72 HORAS -->
		<p:confirmDialog widgetVar="atuacaoDialog"  id="atuacaoDialog" 
		   width="500"
			header="Confirmação" severity="alert"
			appendTo="@(body)">
			<f:facet name="message">
     			<h:outputFormat value="#{cronogramaFormMB.mensagemValidaJunta}" />
   			</f:facet>
			<h:form>
				<p:commandButton value="#{msg['label.yes']}"
					oncomplete="atuacaoDialog.hide()" 
					action="#{cronogramaFormMB.validaProfEmOutraJunta}" update="@form"
					styleClass="ui-confirmdialog-yes" icon="ui-icon-check" ajax="false" />
				<p:commandButton value="#{msg['label.no']}"
					onclick="atuacaoDialog.hide()" type="button"
					styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
			</h:form>
		</p:confirmDialog>
	</ui:define>
</ui:composition>